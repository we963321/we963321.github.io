<!doctype html>
<html lang="en">

<head>
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="yes" name="apple-touch-fullscreen" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta charset="UTF-8">
    <title>æ…ˆæ…ˆå»å“ªã„¦</title>
    <link href="css/style.css" rel="stylesheet" type="text/css">
</head>

<body style="">
    <!-- main -->
    <div class="banner">
        <!--img src="images/title.png" alt="award rotation title" class="logo">-->
        <div style="text-align: center; margin-bottom: 20px; padding: 10px;"><H1>æ…ˆæ…ˆåƒä»€éº¼ğŸ˜</H1></div>
        <div class="turnplate">
            <canvas class="item" id="wheelcanvas" width="422px" height="422px"></canvas>
            <img class="pointer" src="images/turnplate-pointer2.png" alt="award rotation start" />
        </div>
    </div>

    <script type="text/javascript" src="js/zepto.min.js"></script>
    <script type="text/javascript" src="js/awardRotate.js"></script>
    <script type="text/javascript">

    // è½‰ç›¤å€åŸŸ
    var turnplate = {
        restaraunts: [], //å¤§è½‰ç›¤çå“åç¨±
        colors: [], //å¤§è½‰ç›¤çå“å€å¡Šå°æ‡‰èƒŒæ™¯é¡è‰²
        outsideRadius: 178, //å¤§è½‰ç›¤å¤–åœ“çš„åŠå¾‘
        textRadius: 145, //å¤§è½‰ç›¤çå“ä½ç½®è·é›¢åœ“å¿ƒçš„è·é›¢
        insideRadius: 58, //å¤§è½‰ç›¤å…§åœ“çš„åŠå¾‘
        startAngle: 0, //é–‹å§‹è§’åº¦

        bRotate: false //false:åœæ­¢;ture:æ—‹è½‰
    };

    $(document).ready(function() {
        //å‹•æ…‹æ·»åŠ å¤§è½‰ç›¤çš„çå“èˆ‡çå“å€åŸŸèƒŒæ™¯é¡è‰²4927
        turnplate.restaraunts = ["éºµé¡", "é£¯é¡", "ä¸­å¼", "æ—¥å¼", "è¥¿å¼", "ç•°åœ‹", "é»å¿ƒ", "æ…ˆæ…ˆ"];
        turnplate.colors = ["#e7ae5d", "#6d8059", "#e7ae5d", "#6d8059", "#e7ae5d", "#6d8059", "#e7ae5d", "#6d8059"];


        var rotateTimeOut = function() {
            $('#wheelcanvas').rotate({
                angle: 0,
                animateTo: 2160,
                duration: 8000,
                callback: function() {
                    alert('å–”NO~!');
                }
            });
        };

        //æ—‹è½‰è½‰ç›¤ item:çå“ä½ç½®; txtï¼šæç¤ºèª;
        var rotateFn = function(item, txt) {
            var angles = item * (360 / turnplate.restaraunts.length) - (360 / (turnplate.restaraunts.length * 2)) - 72;
            if (angles < 270) {
                angles = 270 - angles;
            } else {
                angles = 360 - angles + 270;
            }
            $('#wheelcanvas').stopRotate();
            $('#wheelcanvas').rotate({
                angle: 0,
                animateTo: angles + 1800,
                duration: 8000,
                callback: function() {
                    //showMask();
                    alert('æ­å–œæ…ˆæ…ˆæŠ½åˆ°: '+txt);
                    turnplate.bRotate = !turnplate.bRotate;
                }
            });
        };
        $('.pointer').click(function() {
            if (turnplate.bRotate) return;
            turnplate.bRotate = !turnplate.bRotate;
            //ç²å–éš¨æ©Ÿæ•¸
            var item = rnd(1, turnplate.restaraunts.length);
            //çå“æ•¸é‡ç­‰æ–¼10,æŒ‡é‡è½åœ¨å°æ‡‰çå“å€åŸŸçš„ä¸­å¿ƒè§’åº¦[252, 216, 180, 144, 108, 72, 36, 360, 324, 288]
            rotateFn(item, turnplate.restaraunts[item - 1]);
        
        });
    });


    function rnd(n, m) {
        m = m + 1;
        var rnd = Math.floor(Math.random() * (m - n) + n);
        return rnd;
    }

    //é é¢æ‰€æœ‰å…ƒç´ åŠ è¼‰å®Œç•¢å¾ŒåŸ·è¡ŒdrawRouletteWheel()æ–¹æ³•å°è½‰ç›¤é€²è¡Œæ¸²æŸ“
    window.onload = function() {
        drawRouletteWheel();
    };

    function drawRouletteWheel() {
        var canvas = document.getElementById("wheelcanvas");
        if (canvas.getContext) {
            //æ ¹æ“šçå“å€‹æ•¸è¨ˆç®—åœ“å‘¨è§’åº¦
            var arc = Math.PI / (turnplate.restaraunts.length / 2);
            var ctx = canvas.getContext("2d");
            //åœ¨çµ¦å®šçŸ©å½¢å…§æ¸…ç©ºä¸€å€‹çŸ©å½¢
            //ctx.clearRect(0,0,422,422);
            //strokeStyle å±¬æ€§è¨­ç½®æˆ–è¿”å›ç”¨æ–¼ç­†è§¸çš„é¡è‰²ã€æ¼¸è®Šæˆ–æ¨¡å¼  
            ctx.strokeStyle = "#FFBE04";
            //font å±¬æ€§è¨­ç½®æˆ–è¿”å›ç•«å¸ƒä¸Šæ–‡æœ¬å…§å®¹çš„ç•¶å‰å­—é«”å±¬æ€§
            ctx.font = '16px Microsoft YaHei';
            for (var i = 0; i < turnplate.restaraunts.length; i++) {
                var angle = turnplate.startAngle + i * arc;
                ctx.fillStyle = turnplate.colors[i];
                ctx.beginPath();
                //arc(x,y,r,èµ·å§‹è§’,çµæŸè§’,ç¹ªåˆ¶æ–¹å‘) æ–¹æ³•å‰µå»ºå¼§/æ›²ç·šï¼ˆç”¨æ–¼å‰µå»ºåœ“æˆ–éƒ¨åˆ†åœ“ï¼‰    
                ctx.arc(211, 211, turnplate.outsideRadius, angle, angle + arc, false);
                ctx.arc(211, 211, turnplate.insideRadius, angle + arc, angle, true);
                ctx.stroke();
                ctx.fill();
                //é–ç•«å¸ƒ(ç‚ºäº†ä¿å­˜ä¹‹å‰çš„ç•«å¸ƒç‹€æ…‹)
                ctx.save();

                //----ç¹ªåˆ¶çå“é–‹å§‹----
                ctx.fillStyle = "#fff";
                var text_allin = turnplate.restaraunts;
                console.log(text_allin.indexOf("8"));
                var text = turnplate.restaraunts[i];
                var line_height = 17;
                //translateæ–¹æ³•é‡æ–°æ˜ å°„ç•«å¸ƒä¸Šçš„ (0,0) ä½ç½®
                ctx.translate(211 + Math.cos(angle + arc / 2) * turnplate.textRadius, 211 + Math.sin(angle + arc / 2) * turnplate.textRadius);
                console.log((angle + arc / 2 + Math.PI / 2));
                //rotateæ–¹æ³•æ—‹è½‰ç•¶å‰çš„ç¹ªåœ–
                ctx.rotate(angle + arc / 2 + Math.PI / 2 - 1.64); //-1.64å®šä½

                /** ä¸‹é¢ä»£ç¢¼æ ¹æ“šçå“é¡å‹ã€çå“åç¨±é•·åº¦æ¸²æŸ“ä¸åŒæ•ˆæœï¼Œå¦‚å­—é«”ã€é¡è‰²ã€åœ–ç‰‡æ•ˆæœã€‚(å…·é«”æ ¹æ“šå¯¦éš›æƒ…æ³æ”¹è®Š) **/
                if (text.length == 2 && i % 2 == 0) { //å¶æ•¸ä½86
                    var texts = text.split("å…ƒ");
                    texts[1] = "";
                    for (var j = 0; j < texts.length; j++) {
                        ctx.fillStyle = "#f4446a";
                        ctx.font = j == 0 ? 'bold 20px Microsoft YaHei' : 'bold 18px Microsoft YaHei';
                        ctx.textAlign = "center";
                        if (j == 0) {
                            ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height + 6);
                        } else {
                            ctx.fillText(texts[j], 12, 5);
                        }
                    }
                } else if (text.length == 2 && i % 2 != 0) { //å¥‡æ•¸ä½86
                    var texts = text.split("å…ƒ");
                    texts[1] = "";
                    for (var j = 0; j < texts.length; j++) {
                        ctx.fillStyle = "#fff";
                        ctx.font = j == 0 ? 'bold 20px Microsoft YaHei' : 'bold 18px Microsoft YaHei';
                        ctx.textAlign = "center";
                        if (j == 0) {
                            ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height + 6);
                        } else {
                            ctx.fillText(texts[j], 12, 5);
                        }
                    }
                } else if (i % 2 != 0) { //å¶æ•¸ä½å…¶ä»–
                    var texts = text.split("å…ƒ");
                    texts[2] = "";
                    for (var j = 0; j < texts.length; j++) {
                        ctx.font = j == 0 ? 'normal 28px Microsoft YaHei' : 'bold 18px Microsoft YaHei';
                        ctx.textAlign = "center";
                        if (j == 0) {
                            ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height + 6);
                        } else {
                            ctx.fillText(texts[j], 12, 5);
                        }
                    }
                } else { //å¥‡æ•¸ä½å…¶ä»–
                    var texts = text.split("å…ƒ");
                    texts[2] = "";
                    ctx.fillStyle = "#f4446a";
                    for (var j = 0; j < texts.length; j++) {
                        ctx.font = j == 0 ? 'normal 28px Microsoft YaHei' : 'bold 18px Microsoft YaHei';
                        ctx.textAlign = "center";
                        if (j == 0) {
                            ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height + 6);
                        } else {
                            ctx.fillText(texts[j], 12, 5);
                        }
                    }
                }
                //æŠŠç•¶å‰ç•«å¸ƒè¿”å›ï¼ˆèª¿æ•´ï¼‰åˆ°ä¸Šä¸€å€‹save()ç‹€æ…‹ä¹‹å‰ 
                ctx.restore();
                //----ç¹ªåˆ¶çå“çµæŸ----
            }
        }
    }
    </script>
</body>

</html>
